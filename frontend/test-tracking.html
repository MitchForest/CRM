<!DOCTYPE html>
<html>
<head>
    <title>Test Tracking</title>
</head>
<body>
    <h1>Activity Tracking Test</h1>
    <button onclick="trackPageView()">Track Page View</button>
    <button onclick="trackEvent()">Track Event</button>
    <button onclick="trackConversion()">Track Conversion</button>
    <button onclick="simulateUserJourney()">Simulate User Journey</button>
    
    <div id="log"></div>

    <script>
        const API_URL = 'http://localhost:8080/api/public';
        const visitorId = 'test_visitor_' + Date.now();
        const sessionId = 'test_session_' + Date.now();
        
        function log(message) {
            document.getElementById('log').innerHTML += '<p>' + message + '</p>';
        }
        
        async function trackPageView() {
            const response = await fetch(`${API_URL}/track/pageview`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    page_url: '/test-page',
                    page_title: 'Test Page',
                    referrer: 'https://google.com'
                })
            });
            const data = await response.json();
            log('Page view tracked: ' + JSON.stringify(data));
        }
        
        async function trackEvent() {
            const response = await fetch(`${API_URL}/track/event`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    event: 'button_click',
                    properties: { button: 'test' }
                })
            });
            const data = await response.json();
            log('Event tracked: ' + JSON.stringify(data));
        }
        
        async function trackConversion() {
            const response = await fetch(`${API_URL}/track/conversion`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    conversion_type: 'demo_scheduled',
                    conversion_value: 1000
                })
            });
            const data = await response.json();
            log('Conversion tracked: ' + JSON.stringify(data));
        }
        
        async function simulateUserJourney() {
            log('Starting user journey simulation...');
            
            // Visit homepage
            await fetch(`${API_URL}/track/pageview`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    page_url: '/',
                    page_title: 'Homepage',
                    referrer: 'https://google.com'
                })
            });
            log('Visited homepage');
            
            await new Promise(r => setTimeout(r, 1000));
            
            // Visit pricing page
            await fetch(`${API_URL}/track/pageview`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    page_url: '/pricing',
                    page_title: 'Pricing',
                    referrer: '/'
                })
            });
            log('Visited pricing page');
            
            await new Promise(r => setTimeout(r, 1000));
            
            // Open chat
            await fetch(`${API_URL}/track/event`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    event: 'chat_opened',
                    properties: { source: 'pricing_page' }
                })
            });
            log('Opened chat');
            
            await new Promise(r => setTimeout(r, 1000));
            
            // Visit demo page
            await fetch(`${API_URL}/track/pageview`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    page_url: '/demo',
                    page_title: 'Book a Demo',
                    referrer: '/pricing'
                })
            });
            log('Visited demo page');
            
            await new Promise(r => setTimeout(r, 1000));
            
            // Schedule demo
            await fetch(`${API_URL}/track/conversion`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    visitor_id: visitorId,
                    session_id: sessionId,
                    conversion_type: 'demo_scheduled',
                    conversion_value: 5000
                })
            });
            log('Scheduled demo - journey complete!');
        }
    </script>
</body>
</html> 