# SuiteCRM Headless Mode Configuration

<IfModule mod_rewrite.c>
    Options +FollowSymLinks
    RewriteEngine On
    
    # Allow direct access to React frontend (if proxied)
    RewriteCond %{REQUEST_URI} ^/$ [OR]
    RewriteCond %{REQUEST_URI} ^/index\.html$
    RewriteRule ^ - [L]
    
    # Route v8 API requests to Api/index.php
    RewriteCond %{REQUEST_URI} ^/Api/V8
    RewriteRule ^Api/(.*)$ Api/index.php [QSA,L]
    
    # Route all /api requests to standalone API
    RewriteCond %{REQUEST_URI} ^/api
    RewriteRule ^api/(.*)$ custom/api/standalone.php/api/$1 [QSA,L]
    
    # Allow access to API endpoints
    RewriteCond %{REQUEST_URI} ^/api [OR]
    RewriteCond %{REQUEST_URI} ^/Api [OR]
    RewriteCond %{REQUEST_URI} ^/service [OR]
    RewriteCond %{REQUEST_URI} ^/cache [OR]
    RewriteCond %{REQUEST_URI} ^/upload [OR]
    RewriteCond %{REQUEST_URI} ^/themes
    RewriteRule ^ - [L]
    
    # Allow access to necessary resources
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # Everything else goes to index.php
    RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>

# Security headers for API
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Protect sensitive files
<FilesMatch "\.(log|tpl|mysql|sql)$">
    Order allow,deny
    Deny from all
</FilesMatch>
